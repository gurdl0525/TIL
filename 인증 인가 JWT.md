# 인증, 인가, JWT

## 인증
유저가 누구인지 확인 하는 절차
##### (회원가입 및 로그인이 해당된다)
## 인가
유저에 대한 권한을 허락하는 것으로<br>유저가 요청하는 request를 실행할 수 있는<br>권한이 있는 유저인가를 확인하는 절차
<br><br>

인증 과정을 진행하면서 
1. 정보를 첨부해 통신을 보낼 수 있게
2. 민감한 정보는 일정시간 동안 유효하게
3. 도용 되지 않게

라는 조건이 생긴다.<br>위 조건을 고려하는 방법은 아래 세 가지이다.

1. 아이디와 비밀번호를 같이 보낸다.<br>(하지만 이 방법은 매번 서버에서 확인을 해야 한다는 점과 정보의 민감성이 단점이다.)
2. 시간 제한이 있는 임시 아이디를 보낸다.<br>(어떤 유저인지 파악하기 힘들다는 단점이 있다.)
3. 일정 시간 동안 인가에 유용한 정보로 대체한다.<br>(이때 사용하는 것이 JSON Web Token이다.)
<br>&nbsp;

---

##  JWT(JSON Web Token)
JSON 방식을 사용하는<br>Web(정보를 공유할 수 있는 공간)<br>Token(정보를 지닌 물리적 • 가상적 물체)
## 개념
유저를 인증하고 식별하기 위한 토큰기반 인증이다.<br>(또 토큰은 서버가 아닌 클라이언트에 저장된다. 때문에 서버의 부담을 덜어준다.)
## 특징  
+ 토큰 자체에 사용자의 권한 정보와<br>서비스를 이용하기 위한 정보들을 포함시킨다.
+  데이터가 많아지면 토큰이 커진다.
+ <span style="color:red">사용자의 정보를 바꾸어도<br>토큰을 재발급 하지 않는 이상 반영되지 않는다</span>.
+ 무상태(Stateless)인 환경에서 데이터를 주고받을 수 있다.<br>클라이언트에 저장하고, 단순히 HTTP헤더파일에 토큰을 첨부하면<br>단순하게 데이터를 요청하고 응답 받을 수 있다.
+ 코드화(encoding) : 누구나 decode할 수 있다.
+ 암호화 : 복호화를 아무나 하지 못함<br>다른 서버는 인가가 되지 않아서 복호화가 <br>(도용 문제 해결)

## 토큰을 만드는 과정
+ 먼저 table 아이디를 준다.
+ 그 정보를 JSON 형태로 전달한다.<br>(정보는 객체)
+ 이때 유효 기간도 같이 전달한다.
```
ex) {"id":1, "exp": 2019_12_19}
```
+ http headers에서 이용할 수 있도록 JSON 을 'token'화 함.
+ Authorization header 부분에 같이 첨부해서 보냄.
<br><br>

---

## Authorization 절차
1. Authentication 절차를 통해 access token을 생성한다.<br>(access token에는 유저 정보를 확인할 수 있는 정보가 들어가 있어야 한다)
2. 유저가 request를 보낼때 access token을 첨부해서 보낸다.
3. 서버에서는 유저가 보낸 access token을 복호화 한다.
4. 복호화된 데이터를 통해 user id를 얻는다.
5. user id를 사용해서 database에서 해당 유저의 권한(permission)을 확인하다.
6. 유저가 충분한 권한을 가지고 있으면 해당 요청을 처리한다.
7. 유저가 권한을 가지고 있지 않으면 다른 에러 코드를 보낸다.